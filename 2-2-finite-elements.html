<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; The Finite Element Method â€“ PX912 Continuum and Mesoscale Modelling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./2-1-macro-solids.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-d166b450ba5a8e9f7a0ab969bf6592c1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b7c2d8834e08b04a63bb76a724ffbcac.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-c1966a8c70583a3816b1e3a216c1caf1.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./2-0-solids.html">Solids</a></li><li class="breadcrumb-item"><a href="./2-2-finite-elements.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Finite Element Method</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">PX912 Continuum and Mesoscale Modelling</a> 
        <div class="sidebar-tools-main">
    <a href="./PX912-Continuum-and-Mesoscale-Modelling.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Module overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./1-0-fluids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fluids</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-1-macro-fluids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Macroscopic Modelling of Fluids</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-2-equations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Governing Equations of Fluid Dynamics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-3-canonical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Canonical Flows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-4-free-surfaces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Free Surface Flows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-5-thin-films.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Lubrication and Thin Film Dynamics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./2-0-solids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solids</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-1-macro-solids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Linear Elasticity Theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-2-finite-elements.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Finite Element Method</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#a-first-problem-a-thin-column" id="toc-a-first-problem-a-thin-column" class="nav-link active" data-scroll-target="#a-first-problem-a-thin-column"><span class="header-section-number">7.1</span> A first problem: a thin column</a></li>
  <li><a href="#the-weak-form" id="toc-the-weak-form" class="nav-link" data-scroll-target="#the-weak-form"><span class="header-section-number">7.2</span> The weak form</a></li>
  <li><a href="#discretisation" id="toc-discretisation" class="nav-link" data-scroll-target="#discretisation"><span class="header-section-number">7.3</span> Discretisation</a>
  <ul class="collapse">
  <li><a href="#choosing-shape-functions" id="toc-choosing-shape-functions" class="nav-link" data-scroll-target="#choosing-shape-functions">Choosing shape functions</a></li>
  </ul></li>
  <li><a href="#improving-our-approximation" id="toc-improving-our-approximation" class="nav-link" data-scroll-target="#improving-our-approximation"><span class="header-section-number">7.4</span> Improving our approximation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./2-0-solids.html">Solids</a></li><li class="breadcrumb-item"><a href="./2-2-finite-elements.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Finite Element Method</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Finite Element Method</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="hidden">

</div>
<p>Analytical solutions for mechanics problems tend to exist only in relatively simple problems, with simple constitutive relations. To get more accurate models of real-world situations, we need to resort to numerical methods, just as we must do with fluid modelling.</p>
<p>A highly successful methodology for solving the equations of solid mechanics is known as the <em>Finite Element Method (FEM)</em>. In this chapter, we will begin introducing this framework for dealing with partial differential equations. A core part of the idea of FEM is to relax the requirement that the functions involved need to be differentiable, and work with a <em>weak form</em> of the equations. This is unlikely to be intuitive to you at first, but hopefully you will see the utility as we go on!</p>
<p>The general steps to derive a finite element approximation of the solution of a PDE are as follows:</p>
<ul>
<li><p>Write down the full PDE problem with boundary conditions. This is known as the <em>strong form</em> of the problem.</p></li>
<li><p>Multiply by a <em>test function</em> and use integration by parts to derive an integral formulation of the problem. This is the <em>weak form</em> of the problem.</p></li>
<li><p>Introduce a <em>discrete basis</em> of functions to express approximate both weak solutions to the problem and test functions.</p></li>
<li><p>Derive a system of <em>discrete equations</em> for the coefficients of the basis which can then be solved numerically.</p></li>
</ul>
<p>In practice, the steps to do this are typically handled by dedicated software, but here we will focus on building understanding of the methodology by working through the derivation ourselves. This will clarify much of the terminology around finite elements, and allow us to discuss some subtleties.</p>
<section id="a-first-problem-a-thin-column" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="a-first-problem-a-thin-column"><span class="header-section-number">7.1</span> A first problem: a thin column</h2>
<div id="fig-thinrod" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-thinrod-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="tikz/ThinRod.svg" style="height:5cm" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-thinrod-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.1: A thin column loaded from above, subject to a gravitational body force.
</figcaption>
</figure>
</div>
<p>In order to give a concrete illustration of how this method works, we will consider a simple test problem in 1D. This is simple enough that we can work out the solution analytically as a way to validate a numerical implementation.</p>
<p>Consider a thin column which we think of as undergoing only small displacements in the <span class="math inline">X</span> and <span class="math inline">Y</span> directions, as illustrated in <a href="#fig-thinrod" class="quarto-xref">Figure&nbsp;<span>7.1</span></a>. If the cross-section of the column is much smaller than the overall length, and displacements in the <span class="math inline">X</span> and <span class="math inline">Y</span> directions are small, we expect to be able to look for solutions that take the form <span class="math inline">{\boldsymbol u}= (0,0,w(Z))</span>. Substituting this into the elasticity equations (and do some asymptotic analysis that we skip over here), we find that <span class="math inline">w</span> should satisfy the problem <span class="math display">
\frac{\partial}{\partial Z}\left(E\frac{\partial w}{\partial Z}\right)=\rho g,
</span> where <span class="math inline">E</span> is the Youngâ€™s modulus of the material, <span class="math inline">\rho</span> is its density and <span class="math inline">g</span> is the acceleration due to gravity.</p>
<p>To model the set up further, we must prescribe boundary conditions. We will assume the column sits on a rigid base at <span class="math inline">Z=0</span>, so <span class="math inline">w(0) = 0</span>, and that the top end of the column is subject to a normal compressive stress <span class="math inline">{\boldsymbol S}{\boldsymbol e}_3 = -\sigma{\boldsymbol e}_3</span> with <span class="math inline">\sigma\geq 0</span>. Dropping the subscripts for short, our problem is <span id="eq-colstrongform"><span class="math display">
\frac{d}{dZ}\left(E\frac{dw}{dZ}\right)=\rho g,\quad w(0) = 0\quad\text{and}\quad E\frac{dw}{dZ}(L) = -\sigma.
\tag{7.1}</span></span> This is the full <em>strong form</em> of the problem; a conventional solution requires <span class="math inline">w</span> to have 2 derivatives, and satisfying the boundary conditions at the ends.</p>
<p>In this case, we can find the solution directly. Solving analytically by integrating twice and applying the boundary conditions, we find the solution is <span class="math display">
w(Z)=\frac{\rho g}{2E}Z^2- \frac{\rho gL}{E}Z-\frac{\sigma}{E}Z.
</span> We can use our solution to make some meaningful predictions: the new length of the column under these conditions is given by the original length plus the displacement of the endpoint, i.e. <span class="math display">
\text{New length} = L+w(L) = L \left(1-\frac{\rho gL}{2E}-\frac{\sigma}{E}\right).
</span> We see that the denser the column and the greater the load applied, the shorter the column gets, which makes intuitive sense. We can also use our solution to find the stress acting at the base, which is <span class="math display">
\text{Stress acting on base} = E\frac{dw}{dZ}(0) = -\rho g L-\sigma.
</span> The first of these terms reflects the weight of the column (mass density times gravitational field strength times volume), while the latter is the load acting on the top of the column being transmitted to the base.</p>
</section>
<section id="the-weak-form" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="the-weak-form"><span class="header-section-number">7.2</span> The weak form</h2>
<p>To proceed in our journey towards a finite element approximate solution of the mechanical problem, we next generate a <em>weak form</em> for <a href="#eq-weakform" class="quarto-xref">Equation&nbsp;<span>7.2</span></a>. The general procedure for this is to:</p>
<ul>
<li><p>Multiply the equation by a <em>test function</em> defined on the problem domain;</p></li>
<li><p>Integrate the result over the domain; and then</p></li>
<li><p>Use integration by parts to move one or more derivatives from the function we are solving for onto the test function.</p></li>
</ul>
<p>In the problem we are considering, we denote the test function <span class="math inline">\phi</span> (also called a <em>weight function</em> in the Engineering literature). Integrating over the domain gives <span class="math display">
\int_0^L\frac{d}{dZ}\left(E\frac{dw}{dZ}\right)\phi\,dZ=\int_0^L\rho g\phi \,dZ.
</span> If we integrate by parts in the first term, on the left-hand side we obtain <span class="math display">
\int_0^L\frac{d}{dZ}\left(E\frac{dw}{dZ}\right)\phi\,dZ = \left[E\frac{dw}{dZ}\phi\right]_{Z=0}^{Z=L}-\int_0^LE\frac{dw}{dZ}\frac{d\phi}{dZ}\,dZ
</span> Substituting in the boundary condition at <span class="math inline">Z=L</span>, and assuming that the test function satisfies <span class="math inline">\phi(0)=0</span>, our integral form can be rearranged to give <span id="eq-weakform"><span class="math display">
\int_0^LE\frac{dw}{dZ}\frac{d\phi}{dZ}\,dZ+\sigma \phi(L)+\int_0^L\rho g\phi \,dZ=0.
\tag{7.2}</span></span> We now argue as follows: if <span class="math inline">w</span> were a solution of the strong form <a href="#eq-colstrongform" class="quarto-xref">Equation&nbsp;<span>7.1</span></a>, then the equality we have derived must hold for any choice of test function <span class="math inline">\phi</span>. We can see the test function as a sort of â€˜measurementâ€™ of how well the equation is satisfied; if there was a region where the equation wasnâ€™t satisfied, we could find <span class="math inline">\phi</span> to make the left-hand side of <a href="#eq-weakform" class="quarto-xref">Equation&nbsp;<span>7.2</span></a> would give a non-zero result.</p>
<p>This leads us to define the concept of a <em>weak solution</em> for our problem. A <em>weak solution</em> is a function <span class="math inline">w</span> which satisfies the integral equality <a href="#eq-weakform" class="quarto-xref">Equation&nbsp;<span>7.2</span></a> for any test function <span class="math inline">\phi</span> satisfying <span class="math inline">\phi(0)=0</span>. The reason that we call this a weak solution is that we only need <span class="math inline">w</span> to have one derivative to make sense of the integral on the left-hand side, whereas the strong form requires us to make sense of two derivatives. In fact, we assume even less: <span class="math inline">w</span> only needs to have a derivative <em>piecewise</em>, so can have a finite number of points where it jumps. The way we have derived the weak form ensures that any solution to the strong form must satisfy the weak form, but the reverse need not necessarily be true.</p>
<p>You may be wondering at this stage why we required that the test function satisfies <span class="math inline">\phi(0)=0</span>. It turns out that this is always the right choice when we prescribe the values of the solution itself at the boundary, i.e.&nbsp;any Dirichlet boundary condition, but to really see why requires more context that we can currently give; ask me during a workshop if youâ€™d like to know more.</p>
</section>
<section id="discretisation" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="discretisation"><span class="header-section-number">7.3</span> Discretisation</h2>
<p>So far, it doesnâ€™t seem that weâ€™ve gained anything; weâ€™ve replaced the strong form with the apparently harder to handle weak form. However, what we have gained is the ability to handle solutions that donâ€™t have 2 derivatives. This gives us much more flexibility to discretise our solution (and to do mathematical analysis, but thatâ€™s a story for elsewhere!).</p>
<p>We now need to decide how to approximate solutions to our problem, and weâ€™ll see that we need to approximate test functions too. There are many possible choices available to do this, including polynomials, trigonometric functions, and many more. All can be used to construct approximate solutions in the way we do so below, however the term â€˜finite elementsâ€™ typically refers to the case where we approximate solutions piecewise polynomial functions.</p>
<p>Letâ€™s consider writing an approximate solution (which we call <span class="math inline">w^h</span>) as a linear combination of functions, so <span class="math display">
w^h(Z) = \sum_{i=1}^M d_i N_i(Z).
</span> The functions <span class="math inline">N_i(Z)</span> are going to be (piecewise) polynomials called <em>shape functions</em>. The coefficients <span class="math inline">d_i</span> are unknown constants we call the <em>degrees of freedom (DoFs)</em>. We can use matrix notation to express this relationship: <span class="math display">
w^h(Z) = {\boldsymbol N}(Z){\boldsymbol d}\quad\text{where}\quad
  {\boldsymbol N}(Z)=
  \left(
    \begin{array}{ccc}
      N_1(Z) &amp; \cdots &amp; N_M(Z)
    \end{array}
  \right)
  \quad\text{and}\quad
  {\boldsymbol d}=\left(
    \begin{array}{c}
      d_1 \\ \vdots \\ d_M
    \end{array}
  \right).
</span> We can find the derivative of <span class="math inline">w^h</span> by evaluating <span class="math display">
\frac{dw^h}{dZ}(Z) = {\boldsymbol B}(Z){\boldsymbol d},\quad\text{where}\quad
{\boldsymbol B}(Z):=\frac{d{\boldsymbol N}}{dZ}(Z)=
\left(
    \begin{array}{ccc}
        \frac{dN_1}{dZ} &amp; \cdots &amp; \frac{dN_M}{dZ}
    \end{array}
\right).
</span> This formula is valid as the vector of coefficients <span class="math inline">{\boldsymbol d}</span> doesnâ€™t depend on <span class="math inline">Z</span>.</p>
<p>If test functions <span class="math inline">\phi</span> are approximated in the same ways as <span class="math inline">w</span> (this is known as a <em>Galerkin approximation</em>), then we define <span class="math display">
\phi^h(Z) =
{\boldsymbol N}(Z){\boldsymbol \phi}
\quad\text{where}\quad
{\boldsymbol \phi}=
\left(
    \begin{array}{c}
          \phi_1 \\ \vdots \\ \phi_M
    \end{array}
\right).
</span> Going back to the weak form <a href="#eq-weakform" class="quarto-xref">Equation&nbsp;<span>7.2</span></a>, letâ€™s replace <span class="math inline">w</span> and <span class="math inline">\phi</span> by the approximations <span class="math inline">w^h</span> and <span class="math inline">\phi^h</span>, giving <span class="math display">
\int_0^LE
\underbrace{\frac{d{\boldsymbol N}}{dZ}{\boldsymbol d}}_{\displaystyle\frac{dw^h}{dZ}}\,
\underbrace{\frac{d{\boldsymbol N}}{dZ}{\boldsymbol \phi}}_{\displaystyle\frac{d\phi^h}{dZ}}\,dZ
+\sigma \underbrace{\vphantom{\frac{d{\boldsymbol N}}{dZ}{\boldsymbol d}}{\boldsymbol N}(L){\boldsymbol \phi}}_{\displaystyle \phi^h(L)}+\int_0^L\rho g\underbrace{\vphantom{\frac{d{\boldsymbol N}}{dZ}{\boldsymbol d}}{\boldsymbol N}{\boldsymbol \phi}}_{\displaystyle \phi^h} \,dZ=0.
</span> Since <span class="math inline">{\boldsymbol N}{\boldsymbol \phi}</span> and <span class="math inline">{\boldsymbol B}{\boldsymbol \phi}</span> are scalars, we have <span class="math inline">{\boldsymbol N}{\boldsymbol \phi}= {\boldsymbol \phi}^T{\boldsymbol N}^T</span> and <span class="math inline">{\boldsymbol B}{\boldsymbol \phi}= {\boldsymbol \phi}^T{\boldsymbol B}^T</span>. We can use the latter result to write the integral on the right hand side as: <span class="math display">
\int_0^LE{\boldsymbol B}{\boldsymbol d}{\boldsymbol B}{\boldsymbol \phi}\,dZ = {\boldsymbol \phi}^T\left(\int_0^LE{\boldsymbol B}^T{\boldsymbol B}\,dZ\right){\boldsymbol d}.
</span> The bracketed term on the right is a matrix, called the <em>stiffness matrix</em>, often denoted <span class="math inline">{\boldsymbol K}</span>. It has entries: <span class="math display">
K_{ij} = \int_0^LE\frac{dN_i}{dZ}\frac{dN_j}{dZ}\,dZ.
</span> Note that <span class="math inline">{\boldsymbol K}</span> is symmetric, so <span class="math inline">{\boldsymbol K}= {\boldsymbol K}^T</span>. Introducing the column vector <span class="math display">
{\boldsymbol f}:= \sigma {\boldsymbol N}(L)^T + \int_0^L \rho g {\boldsymbol N}^T\,dZ,
</span> we can write the approximate weak form as <span id="eq-coldiscreteform"><span class="math display">
{\boldsymbol \phi}^T{\boldsymbol K}{\boldsymbol d}+ {\boldsymbol \phi}^T{\boldsymbol f}={\boldsymbol \phi}^T({\boldsymbol K}{\boldsymbol d}+{\boldsymbol f})=0.
\tag{7.3}</span></span> If we want the approximate weak form to hold for all approximate solutions, then <a href="#eq-coldiscreteform" class="quarto-xref">Equation&nbsp;<span>7.3</span></a> has to hold for all vectors <span class="math inline">{\boldsymbol \phi}</span>, and that means that <span class="math inline">{\boldsymbol d}</span> is the vector which solves the equation <span class="math inline">{\boldsymbol K}{\boldsymbol d}+{\boldsymbol f}=\boldsymbol{0}</span>, which we can solve (if we know <span class="math inline">{\boldsymbol K}</span> and <span class="math inline">{\boldsymbol f}</span>!) using a linear solve.</p>
<p>Note that just as for the finite difference methods we thought about in the Fluids part of the module, we end up needing to solve a linear system of equations where <span class="math inline">{\boldsymbol f}</span> encodes both the forces acting in the domain and aspects of the boundary conditions!</p>
<section id="choosing-shape-functions" class="level3">
<h3 class="anchored" data-anchor-id="choosing-shape-functions">Choosing shape functions</h3>
<p>The abstract work we did above didnâ€™t need us to make any particular choice of shape function, but now we need to make a choice to put the methodology into practice. The usual choice for FEM in particular is to split the domain into <em>elements</em> which are subvolumes of the domain. For example, we could split the domain <span class="math inline">[0,L]</span> into 3 equal pieces, the intervals <span class="math inline">(0,\frac13L)</span>, <span class="math inline">(\frac13L,\frac23L)</span>, and <span class="math inline">(\frac23L,L)</span>, as shown in <a href="#fig-basisoverlap" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>. Then, we choose a polynomial <em>order</em> on each interval. If we choose <em>first-order</em> or <em>piecewise linear</em> elements, then we have that each shape function is <span class="math display">
N_i(Z) = a_0+a_1Z,
</span> where the constants <span class="math inline">a_0</span> and <span class="math inline">a_1</span> will depend on which element we are on. To specify the shape functions further, we make two requirements:</p>
<ol type="1">
<li>At the end-points of the elements, <span class="math inline">Z_k = \frac{k}{3}L</span>, the shape functions are <em>continuous</em>.</li>
<li>The shape functions have the <em>interpolation</em> or Kronecker delta property, which is the requirement that <span class="math display">
  N_i(Z_k)
  = \delta_{ik}
  =
  \begin{cases}
1 &amp; i=k\\
0 &amp; i\neq k.
  \end{cases}
  </span></li>
</ol>
<p>These choices lead us to define 4 shape functions (for convenience, we define <span class="math inline">h = L/3</span>): <span class="math display">
\begin{aligned}
    N_0(Z) &amp;=
    \begin{cases}
        1-\frac{Z}{h} &amp; 0\leq Z\leq h\\
        0 &amp; \text{otherwise},
    \end{cases}
    &amp;
    N_1(Z) &amp;=
    \begin{cases}
        \frac{Z}{h} &amp; 0 \leq Z\leq h\\
        2-\frac{Z}{h} &amp; h \leq Z\leq 2h\\
        0 &amp; \text{otherwise},
    \end{cases}\\
    N_2(Z) &amp;=
    \begin{cases}
        \frac{Z}{h}-1 &amp; h \leq Z\leq 2h\\
        3-\frac{Z}{h} &amp; 2h \leq Z\leq 3h\\
        0 &amp; \text{otherwise},
    \end{cases}&amp;
    N_3(Z) &amp;=
    \begin{cases}
        \frac{Z}{h}-2 &amp; 2h \leq Z \leq 3h\\
        0 &amp; \text{otherwise}.
    \end{cases}
\end{aligned}
</span> These functions are illustrated in <a href="#fig-basisoverlap" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>.</p>
<div id="fig-basisoverlap" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-basisoverlap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="tikz/BasisOverlap.svg" style="height:5cm" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-basisoverlap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.2: The spatial grid with the 3 piecewise linear shape functions. Note the overlapping regions where adjacent basis functions are non-zero.
</figcaption>
</figure>
</div>
<p>In this case, the derivatives are: <span class="math display">
\begin{aligned}
    \frac{dN_0}{dZ}(Z) &amp;=
    \begin{cases}
        -\frac{1}{h} &amp; 0\leq Z\leq h\\
        0 &amp; \text{otherwise},
    \end{cases}
    &amp;\frac{dN_1}{dZ}(Z) &amp;=
    \begin{cases}
        \frac{1}{h} &amp; 0 \leq Z\leq h\\
        -\frac{1}{h} &amp; h \leq Z\leq 2h\\
        0 &amp; \text{otherwise},
    \end{cases}\\
    \frac{dN_2}{dZ}(Z) &amp;=
    \begin{cases}
        \frac{1}{h} &amp; h \leq Z\leq 2h\\
        -\frac{1}{h} &amp; 2h \leq Z\leq 3h\\
        0 &amp; \text{otherwise},
    \end{cases}&amp;
    \frac{dN_3}{dZ}(Z) &amp;= \begin{cases}
        \frac{1}{h} &amp; 2h \leq Z \leq 3h\\
        0 &amp; \text{otherwise}.
    \end{cases}
\end{aligned}
</span></p>
<p>Before proceeding, we note that there is one shape function we wonâ€™t need. Recall that we want <span class="math inline">w(0)=0</span> and <span class="math inline">\phi(0)=0</span>. In order to enforce this conditions, we can simply discard any entries involving <span class="math inline">N_0</span> (setting <span class="math inline">d_0=0</span> and <span class="math inline">\phi_0=0</span>), as this is the only shape function that is non-zero at the end.</p>
<p>To assemble the stiffness matrix, <span class="math inline">{\boldsymbol K}</span>, we now need to compute <span class="math display">
K_{ij} = \int_0^L E\frac{dN_i}{dZ}\frac{dN_j}{dZ}\,dZ.
</span> Letâ€™s do an example for the case where <span class="math inline">i=j=2</span>, so we compute entry <span class="math inline">K_{22}</span>. In this case, we need to compute <span class="math display">
\begin{aligned}
    K_{22} = \int_0^L E\left(\frac{dN_2}{dZ}\right)^2\,dZ
    &amp;= \int_h^{2h}E\frac{1}{h^2}\,dZ+\int_{2h}^{3h} E\left(-\frac{1}{h}\right)^2\,dZ\\
    &amp;=\frac{E}{h}+\frac{E}{h} = \frac{2E}{h}.
\end{aligned}
</span> On the first line, we note that the integral over the interval <span class="math inline">(0,h)</span> is zero, so we discard it. In general, we only need to compute the integrals on the elements where the regions where the shape functions have non-zero derivative (the fancy maths word for this is the <em>support</em> of the shape function).</p>
<p>By carefully splitting up the domain and working through the cases, you can check that <span class="math display">
{\boldsymbol K}=
\frac{E}{h}\left(
\begin{array}{rrr}
    2 &amp; -1 &amp; 0 \\
    -1 &amp;  2 &amp; -1 \\
    0 &amp; -1  &amp; 1
\end{array}
\right).
</span> The <span class="math inline">K_{22}</span> entry is the central one in the matrix (<span class="math inline">K_{ij}</span> is the entry in the <span class="math inline">i</span>th row and <span class="math inline">j</span>th column). To find the vector <span class="math inline">{\boldsymbol f}</span>, we need to evaluate the shape functions and calculate more integrals. In this case, <span class="math display">
\sigma {\boldsymbol N}^T(L) = \sigma
  \left(
    \begin{array}{c}
      0 \\ 0 \\ 1
    \end{array}
  \right),\qquad\text{and}\qquad \rho g\int_0^L{\boldsymbol N}^TdZ = \rho g h
  \left(
    \begin{array}{c}
      1 \\ 1 \\ \frac12
    \end{array}
  \right).
</span> Putting everything together and rearranging, we find we must solve <span id="eq-coldiscrete3element"><span class="math display">
\frac{E}{h}\left(
    \begin{array}{rrr}
      2 &amp; -1 &amp; 0 \\
     -1 &amp;  2 &amp; -1 \\
      0 &amp; -1  &amp; 1
    \end{array}
  \right)\left(
    \begin{array}{c}
      d_1 \\ d_2 \\ d_3
    \end{array}
  \right)
  =-\left(
    \begin{array}{c}
      \rho g h \\ \rho g h \\ \frac12\rho g h + \sigma
    \end{array}
  \right).
\tag{7.4}</span></span> If we solve and append the <span class="math inline">d_0=0</span> degree of freedom which we discarded, we see we get incredibly close agreement with the analytic solution; see <a href="#fig-colcomparison" class="quarto-xref">Figure&nbsp;<span>7.3</span></a>.</p>
<div id="fig-colcomparison" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-colcomparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/ColumnComparison.png" class="img-fluid figure-img" style="width:8cm">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-colcomparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.3: Comparison of the analytic solution (dashed) and the finite element solution (solid) for the column problem with 3 elements. The values of the approximate solution at the nodes are shown with plus signs. Parameters for stainless steel were used, with an applied load of <span class="math inline">\sigma=50</span>kPa. Given how stiff steel is, the displacement is very small, fractions of a micrometre!
</figcaption>
</figure>
</div>
</section>
</section>
<section id="improving-our-approximation" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="improving-our-approximation"><span class="header-section-number">7.4</span> Improving our approximation</h2>
<p>Our derivation here is obviously not limited to dividing the domain into <span class="math inline">3</span> elements: in 1D, if we choose to divide the domain into <span class="math inline">M</span> elements, we get <span class="math inline">M+1</span> piecewise linear shape functions. If we make the elements smaller, we expect to get a better approximation to the true solution: indeed, this is something we will discuss later on in the module. We will see that when things are working correctly, the error in our solution is controlled by <span class="math inline">h</span>, the size of the largest element used. An important thing to note is that in general, the elements do not all have to be the same size; indeed, this will be an important consideration in the chapters to come! Even in the case we have considered here, we could freely split the domain into other sets of three parts; for example we could set <span class="math inline">Z_1=\tfrac12</span> and <span class="math inline">Z_2=\tfrac34</span>, which would result in different shape functions.</p>
<p>Instead of dividing the domain into more elements, another option to get better agreement with the solution is to increase the polynomial order of the shape functions, for example by setting <span class="math display">
N_i(Z) = a_0+a_1Z+a_2Z^2
</span> on each element. In this case, continuity and the Kronecker delta property for the endpoints of the elements are not enough on their own to define the shape functions uniquely. Instead, we need to add extra <em>nodes</em> to each element. The usual choice for quadratic functions is to add an extra node in the middle of each element. A plot of the resulting shape functions is shown in <a href="#fig-quadraticshapefuncs" class="quarto-xref">Figure&nbsp;<span>7.4</span></a>; you will be asked to find the form of these (on a single element) in this weekâ€™s workshop. You could go even further, using cubics, quartics or even higher order polynomials, but you would need to add more nodes.</p>
<div id="fig-quadraticshapefuncs" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-quadraticshapefuncs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="tikz/QuadraticShapeFunctions.svg" style="height:5cm" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-quadraticshapefuncs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.4: A plots of the quadratic shape functions on domain made up of two elements. One element covers the interval <span class="math inline">(Z_0,Z_2)</span>, the other covers the interval <span class="math inline">(Z_2,Z_4)</span>. Note that <span class="math inline">Z_1</span> and <span class="math inline">Z_3</span> are extra nodes added to the centre of the element.
</figcaption>
</figure>
</div>
<p>Note that the problem we end up with to solve, <a href="#eq-coldiscrete3element" class="quarto-xref">Equation&nbsp;<span>7.4</span></a>, looks very similar to the way we discretised a second-order problem with finite differences, even if the philosophy that we used to get to it is rather different. Indeed, you might ask what we have gained by doing all of the work here, and for this particular problem, we have gained very little! However, we will see in later chapters is that the finite element approach is more flexible, particularly when it comes to problems in higher dimensions. Moreover, the philosophy introduced here, while seeming cumbersome at the moment, can be very effectively generalised and automated in software.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./2-1-macro-solids.html" class="pagination-link" aria-label="Linear Elasticity Theory">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Linear Elasticity Theory</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>